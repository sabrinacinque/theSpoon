<!-- Loading Spinner -->
<div *ngIf="loading" class="container-xl py-5">
  <div class="text-center">
    <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="fs-5">üçΩÔ∏è Caricamento dettagli ristorante...</p>
  </div>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="container-xl py-5">
  <div class="alert alert-danger text-center" role="alert">
    <h4 class="alert-heading">Ops! Qualcosa √® andato storto</h4>
    <p class="mb-3">{{ error }}</p>
    <button class="btn btn-outline-danger" (click)="goBack()">
      üîÑ Torna alla homepage
    </button>
  </div>
</div>

<!-- Restaurant Detail -->
<div *ngIf="restaurant && !loading" class="restaurant-detail">

  <!-- Hero Section -->
  <section class="hero-section position-relative">
    <!-- Background Image -->
    <div class="hero-image d-flex align-items-center justify-content-center text-white">
      <div class="text-center">
        <div class="fs-1 mb-2">üì∏</div>
        <small class="badge bg-dark bg-opacity-75 px-3 py-2">94 FOTO</small>
      </div>
    </div>

    <!-- Top Navigation -->
    <div class="position-absolute top-0 start-0 end-0 p-3">
      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-dark btn-lg rounded-circle" (click)="goBack()">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="d-flex gap-2">
          <button class="btn btn-dark btn-lg rounded-circle" (click)="toggleFavorite()">
            <i class="fas fa-heart"></i>
          </button>
          <button class="btn btn-dark btn-lg rounded-circle" (click)="shareRestaurant()">
            <i class="fas fa-share-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Restaurant Info -->
  <section class="restaurant-info bg-dark text-white py-4">
    <div class="container-xl">

      <!-- Name and Address -->
      <h1 class="display-6 fw-bold mb-3">{{ restaurant.name }}</h1>
      <div class="d-flex align-items-center mb-4">
        <i class="fas fa-map-marker-alt text-success me-2"></i>
        <span>{{ restaurant.address }}, {{ restaurant.city }}</span>
      </div>

      <!-- Tags and Price -->
      <div class="d-flex flex-wrap gap-2 mb-4">
        <span class="badge bg-secondary px-3 py-2 rounded-pill">{{ restaurant.cuisineType }}</span>
        <span class="badge bg-secondary px-3 py-2 rounded-pill">DI PESCE</span>
      </div>

      <div class="d-flex align-items-center mb-4">
        <i class="fas fa-euro-sign me-2"></i>
        <span class="fw-semibold">PREZZO MEDIO {{ getPriceRange() }}</span>
      </div>

      <!-- Rating -->
      <div class="text-center py-4">
        <div class="d-flex align-items-center justify-content-center mb-2">
          <i class="fas fa-utensils text-success me-2 fs-4"></i>
          <span class="display-4 fw-bold">{{ restaurant.rating || 0 }}</span>
        </div>
        <p class="text-muted">{{ restaurant.reviewCount || 0 }} recensioni su TheSpoon</p>
      </div>

    </div>
  </section>

  <!-- Strengths Section -->
  <section class="strengths-section bg-dark text-white py-4" *ngIf="strengthsFromReviews.length > 0">
    <div class="container-xl">
      <h3 class="h5 mb-3">
        Punti di forza estratti dalle recensioni degli utenti
        <i class="fas fa-info-circle text-muted ms-2"></i>
      </h3>

      <div class="row">
        <div class="col-12" *ngFor="let strength of strengthsFromReviews">
          <div class="d-flex align-items-center mb-2">
            <i class="fas fa-check text-success me-3"></i>
            <span>{{ strength }}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Discount Banner -->
  <section class="discount-banner bg-secondary py-3">
    <div class="container-xl">
      <div class="d-flex align-items-center text-white">
        <div class="bg-white text-dark rounded-circle p-2 me-3">
          <i class="fas fa-percentage"></i>
        </div>
        <div>
          <div class="fw-semibold">Ricevi fino al 20% di sconto</div>
          <small class="text-muted">Potrebbero essere applicate condizioni</small>
        </div>
      </div>
    </div>
  </section>

  <!-- Booking Section -->
  <section class="booking-section bg-dark text-white py-4">
    <div class="container-xl">
      <div class="d-flex align-items-center mb-3">
        <i class="fas fa-utensils text-success me-2"></i>
        <h3 class="h5 mb-0">Prenota per</h3>
      </div>

      <!-- Date Selection -->
      <div class="row g-3 mb-4">
        <div class="col-6 col-md-3" *ngFor="let date of availableDates">
          <button
            class="btn btn-outline-success w-100 position-relative"
            (click)="selectDate(date)">
            <div>{{ date.label }}</div>
            <small class="badge bg-success position-absolute top-0 end-0 translate-middle">
              {{ date.discount }}
            </small>
          </button>
        </div>
      </div>

      <div class="text-end">
        <a href="#" class="text-success text-decoration-none">
          VEDI ALTRE DATE <i class="fas fa-chevron-right"></i>
        </a>
      </div>
    </div>
  </section>

  <!-- Menu Section -->
  <section class="menu-section bg-dark text-white py-5">
    <div class="container-xl">
      <h2 class="h3 mb-4">Men√π</h2>
      <div class="badge bg-light text-dark mb-4">
        Ultimo aggiornamento: Luglio 2025
      </div>


      <!-- Price Info -->
      <div class="d-flex align-items-center mb-4 pb-3 border-bottom border-secondary">
        <i class="fas fa-euro-sign me-3"></i>
        <span class="fw-semibold">PREZZO MEDIO {{ getPriceRange() }}</span>
      </div>

      <!-- Menu Items -->
      <h4 class="h5 mb-3">PIATTI HIGHLIGHTS</h4>
      <div class="menu-items">
        <div
          class="d-flex justify-content-between align-items-center py-3 border-bottom border-secondary"
          *ngFor="let item of menuHighlights">
          <span>{{ item.name }}</span>
          <span class="fw-semibold">{{ item.price }} ‚Ç¨</span>
        </div>
      </div>

      <!-- View Full Menu -->
      <div class="text-center mt-4">
        <button class="btn btn-outline-success btn-lg w-100" (click)="viewFullMenu()">
          VEDI IL MEN√ô COMPLETO <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </section>

  <!-- Reviews Section -->
  <section class="reviews-section bg-dark text-white py-5">
    <div class="container-xl">
      <h2 class="h3 mb-4">Recensioni dei nostri clienti</h2>

      <!-- Rating Summary -->
      <div class="d-flex align-items-center mb-4">
        <i class="fas fa-utensils text-success me-3 fs-4"></i>
        <span class="display-6 fw-bold me-3">{{ restaurant.rating || 0 }}</span>
        <span class="text-muted">{{ restaurant.reviewCount || 0 }} recensioni</span>
      </div>

      <!-- Review Quality Badge -->
      <div class="alert alert-dark border border-success mb-4">
        <div class="d-flex align-items-center">
          <i class="fas fa-check-circle text-success me-3"></i>
          <div>
            <div class="fw-semibold">Esperienze reali di clienti reali</div>
            <small class="text-muted">
              Possono lasciare un punteggio e una recensione solo le persone che hanno prenotato con TheSpoon.
            </small>
          </div>
        </div>
      </div>



      <!-- View All Reviews -->
      <div class="text-center">
        <button class="btn btn-outline-success btn-lg w-100 mb-4" (click)="viewAllReviews()">
          LEGGI LE RECENSIONI
        </button>
      </div>

      <!-- TripAdvisor Integration -->
      <div class="d-flex align-items-center justify-content-between p-3 bg-secondary rounded">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="fab fa-tripadvisor fs-3"></i>
            <span class="ms-2">‚óè‚óè‚óè‚óè‚óã</span>
          </div>
          <div>
            <div class="fw-semibold">Recensioni da TripAdvisor</div>
            <small class="text-muted">298 recensioni</small>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Fixed Bottom CTA -->
  <div class="fixed-bottom p-3 bg-dark border-top border-secondary">
    <div class="container-xl">
      <button
        class="btn btn-success btn-lg w-100 fw-bold"
        (click)="bookTable()">
        PRENOTA UN TAVOLO
      </button>
    </div>
  </div>

</div>
